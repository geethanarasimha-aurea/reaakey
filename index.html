<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Typing Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6ecbf5, #ffb6c1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 15px;
            text-align: center;
        }
        
        .manual-input-container {
            margin: 10px 0;
        }
        
        .manual-input {
            padding: 8px;
            border: 2px solid #06d6a0;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            text-align: center;
        }
        
        .manual-input:disabled {
            background-color: #f0f0f0;
            color: #999;
        }
        
        .word-display {
            font-size: 2rem;
            margin: 15px 0;
            color: #073b4c;
            min-height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .current-letter {
            color: #ef476f;
            text-decoration: underline;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .keyboard-container {
            margin-top: 10px;
            background: #e0e0e0;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 0 #bdbdbd;
            overflow-x: auto;
            border: 2px solid #333;
            width: 100%;
        }
        
        .keyboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            min-width: 800px;
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 4px;
            width: 100%;
        }
        
        .key {
            height: 40px;
            margin: 2px;
            background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
            border: 2px solid #333;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 0 #bdbdbd;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            text-align: center;
            padding: 0 4px;
            pointer-events: none;
            flex-shrink: 0;
        }
        
        .key.highlight {
            background: linear-gradient(145deg, #ef476f, #ff6b6b);
            color: white;
            animation: pulse 0.8s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .special-key {
            background: linear-gradient(145deg, #bdbdbd, #9e9e9e);
            color: #333;
        }
        
        .space-key {
            width: 300px;
        }
        
        .enter-key {
            width: 80px;
        }
        
        .tab-key {
            width: 70px;
        }
        
        .caps-key {
            width: 90px;
        }
        
        .shift-key {
            width: 110px;
        }
        
        .ctrl-key, .alt-key, .fn-key, .win-key {
            width: 60px;
        }
        
        .backspace-key {
            width: 90px;
        }
        
        .arrow-container {
            display: flex;
            flex-direction: column;
            height: 40px;
            margin: 2px;
            gap: 2px;
        }
        
        .arrow-row {
            display: flex;
            gap: 2px;
            height: 19px;
        }
        
        .arrow-key {
            width: 30px;
            height: 19px;
            background: linear-gradient(145deg, #bdbdbd, #9e9e9e);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #333;
            border-radius: 4px;
            font-size: 0.6rem;
            box-shadow: 0 2px 0 #bdbdbd;
        }
        
        .controls-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .start-btn {
            background: linear-gradient(to right, #06d6a0, #4cc9f0);
            color: white;
        }
        
        .reset-btn {
            background: linear-gradient(to right, #ffd166, #ff9e6d);
            color: #073b4c;
        }
        
        .speak-btn {
            background: linear-gradient(to right, #ef476f, #ff9e6d);
            color: white;
        }
        
        .mode-btn {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
        }
        
        .active-mode {
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .message {
            margin-top: 10px;
            font-size: 1rem;
            min-height: 25px;
            color: #118ab2;
        }
        
        .completed-word {
            color: #06d6a0;
        }
        
        @media (max-width: 900px) {
            .keyboard {
                min-width: 700px;
            }
            
            .key {
                height: 35px;
                font-size: 0.7rem;
            }
            
            .space-key {
                width: 250px;
            }
            
            .word-display {
                font-size: 1.5rem;
            }
            
            .controls-row {
                gap: 5px;
            }
            
            .control-btn {
                padding: 5px 10px;
                font-size: 0.7rem;
            }
            
            .arrow-key {
                width: 25px;
                height: 16px;
                font-size: 0.5rem;
            }
            
            .arrow-container {
                height: 35px;
            }
            
            .arrow-row {
                height: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="manual-input-container" id="manual-input-container" style="display: none;">
            <input type="text" class="manual-input" id="manual-input" placeholder="Type any word and press Enter">
        </div>
        
        <div class="word-display" id="word-display">Press Start to begin!</div>
        
        <div class="keyboard-container">
            <div class="keyboard" id="keyboard">
                <!-- Keyboard will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="controls-row">
            <button class="control-btn start-btn" id="start-btn">Start</button>
            <button class="control-btn reset-btn" id="reset-btn">Reset</button>
            <button class="control-btn speak-btn" id="speak-btn">Speak</button>
            <button class="control-btn mode-btn active-mode" id="practice-btn">Practice</button>
            <button class="control-btn mode-btn" id="manual-btn">Manual</button>
        </div>
        
        <div class="message" id="message">Select mode and press Start</div>
    </div>

    <script>
        // Word list for practice mode
        const wordList = [
            "apple", "ball", "cat", "dog", "elephant", "fish", "goat", "hat", "ice", "jump",
            "kite", "lion", "monkey", "nest", "orange", "pig", "queen", "rabbit", "sun", "tree"
        ];

        // Updated Keyboard layout with realistic PC layout (removed duplicate bottom row)
        const keyboardLayout = [
            // First row - Function keys
            [
                { key: 'esc', label: 'Esc', width: 60, class: 'special-key' },
                { key: 'f1', label: 'F1', width: 50, class: 'function-key' },
                { key: 'f2', label: 'F2', width: 50, class: 'function-key' },
                { key: 'f3', label: 'F3', width: 50, class: 'function-key' },
                { key: 'f4', label: 'F4', width: 50, class: 'function-key' },
                { key: 'f5', label: 'F5', width: 50, class: 'function-key' },
                { key: 'f6', label: 'F6', width: 50, class: 'function-key' },
                { key: 'f7', label: 'F7', width: 50, class: 'function-key' },
                { key: 'f8', label: 'F8', width: 50, class: 'function-key' },
                { key: 'f9', label: 'F9', width: 50, class: 'function-key' },
                { key: 'f10', label: 'F10', width: 50, class: 'function-key' },
                { key: 'f11', label: 'F11', width: 50, class: 'function-key' },
                { key: 'f12', label: 'F12', width: 50, class: 'function-key' },
                { key: 'del', label: 'Del', width: 60, class: 'special-key' }
            ],
            // Second row - Number row with ~
            [
                { key: '`', label: '` ~', width: 50 },
                { key: '1', label: '1 !', width: 50 },
                { key: '2', label: '2 @', width: 50 },
                { key: '3', label: '3 #', width: 50 },
                { key: '4', label: '4 $', width: 50 },
                { key: '5', label: '5 %', width: 50 },
                { key: '6', label: '6 ^', width: 50 },
                { key: '7', label: '7 &', width: 50 },
                { key: '8', label: '8 *', width: 50 },
                { key: '9', label: '9 (', width: 50 },
                { key: '0', label: '0 )', width: 50 },
                { key: '-', label: '- _', width: 50 },
                { key: '=', label: '= +', width: 50 },
                { key: 'backspace', label: 'Backspace', width: 90, class: 'special-key' }
            ],
            // Third row - Tab row
            [
                { key: 'tab', label: 'Tab', width: 70, class: 'special-key' },
                { key: 'q', label: 'Q', width: 50 },
                { key: 'w', label: 'W', width: 50 },
                { key: 'e', label: 'E', width: 50 },
                { key: 'r', label: 'R', width: 50 },
                { key: 't', label: 'T', width: 50 },
                { key: 'y', label: 'Y', width: 50 },
                { key: 'u', label: 'U', width: 50 },
                { key: 'i', label: 'I', width: 50 },
                { key: 'o', label: 'O', width: 50 },
                { key: 'p', label: 'P', width: 50 },
                { key: '[', label: '[ {', width: 50 },
                { key: ']', label: '] }', width: 50 },
                { key: '\\', label: '\\ |', width: 70, class: 'special-key' }
            ],
            // Fourth row - Caps lock row
            [
                { key: 'caps', label: 'Caps Lock', width: 90, class: 'special-key' },
                { key: 'a', label: 'A', width: 50 },
                { key: 's', label: 'S', width: 50 },
                { key: 'd', label: 'D', width: 50 },
                { key: 'f', label: 'F', width: 50 },
                { key: 'g', label: 'G', width: 50 },
                { key: 'h', label: 'H', width: 50 },
                { key: 'j', label: 'J', width: 50 },
                { key: 'k', label: 'K', width: 50 },
                { key: 'l', label: 'L', width: 50 },
                { key: ';', label: '; :', width: 50 },
                { key: "'", label: '" \'', width: 50 },
                { key: 'enter', label: 'Enter', width: 80, class: 'special-key' }
            ],
            // Fifth row - Shift row
            [
                { key: 'shift', label: 'Shift', width: 110, class: 'special-key' },
                { key: 'z', label: 'Z', width: 50 },
                { key: 'x', label: 'X', width: 50 },
                { key: 'c', label: 'C', width: 50 },
                { key: 'v', label: 'V', width: 50 },
                { key: 'b', label: 'B', width: 50 },
                { key: 'n', label: 'N', width: 50 },
                { key: 'm', label: 'M', width: 50 },
                { key: ',', label: ', <', width: 50 },
                { key: '.', label: '. >', width: 50 },
                { key: '/', label: '/ ?', width: 50 },
                { key: 'shift', label: 'Shift', width: 110, class: 'special-key' }
            ],
            // Sixth row - Space bar row with proper PC layout and arrow keys
            [
                { key: 'ctrl', label: 'Ctrl', width: 60, class: 'special-key' },
                { key: 'fn', label: 'Fn', width: 60, class: 'special-key' },
                { key: 'win', label: '❖', width: 60, class: 'special-key' },
                { key: 'alt', label: 'Alt', width: 60, class: 'special-key' },
                { key: 'space', label: 'Space', width: 300, class: 'special-key' },
                { key: 'alt', label: 'Alt', width: 60, class: 'special-key' },
                { key: 'ctrl', label: 'Ctrl', width: 60, class: 'special-key' }
            ]
        ];

        // Game state
        let currentWordIndex = 0;
        let currentLetterIndex = 0;
        let gameActive = false;
        let currentWord = '';
        let isSpeaking = false;
        let isManualMode = false;
        let isManualInputEnabled = true;

        // DOM elements
        const wordDisplay = document.getElementById('word-display');
        const keyboardElement = document.getElementById('keyboard');
        const startButton = document.getElementById('start-btn');
        const resetButton = document.getElementById('reset-btn');
        const speakButton = document.getElementById('speak-btn');
        const messageElement = document.getElementById('message');
        const practiceBtn = document.getElementById('practice-btn');
        const manualBtn = document.getElementById('manual-btn');
        const manualInputContainer = document.getElementById('manual-input-container');
        const manualInput = document.getElementById('manual-input');

        // Initialize the keyboard with realistic layout
        function initializeKeyboard() {
            keyboardElement.innerHTML = '';
            
            // Add main keyboard rows (only the defined 6 rows)
            keyboardLayout.forEach(row => {
                const rowElement = document.createElement('div');
                rowElement.className = 'keyboard-row';
                
                row.forEach(keyConfig => {
                    const keyElement = document.createElement('div');
                    keyElement.className = 'key';
                    keyElement.textContent = keyConfig.label;
                    keyElement.dataset.key = keyConfig.key;
                    keyElement.style.width = `${keyConfig.width}px`;
                    
                    if (keyConfig.class) {
                        keyElement.classList.add(keyConfig.class);
                    }
                    
                    rowElement.appendChild(keyElement);
                });
                
                // For the last row (space bar row), add arrow keys
                if (row === keyboardLayout[5]) {
                    // Add compact arrow keys container
                    const arrowContainer = document.createElement('div');
                    arrowContainer.className = 'arrow-container';
                    
                    // Top row - only up arrow
                    const topRow = document.createElement('div');
                    topRow.className = 'arrow-row';
                    topRow.style.justifyContent = 'center';
                    
                    const upArrow = document.createElement('div');
                    upArrow.className = 'arrow-key';
                    upArrow.textContent = '▲';
                    upArrow.dataset.key = 'up';
                    topRow.appendChild(upArrow);
                    
                    // Bottom row - left, down, right arrows
                    const bottomArrowRow = document.createElement('div');
                    bottomArrowRow.className = 'arrow-row';
                    
                    const leftArrow = document.createElement('div');
                    leftArrow.className = 'arrow-key';
                    leftArrow.textContent = '◀';
                    leftArrow.dataset.key = 'left';
                    
                    const downArrow = document.createElement('div');
                    downArrow.className = 'arrow-key';
                    downArrow.textContent = '▼';
                    downArrow.dataset.key = 'down';
                    
                    const rightArrow = document.createElement('div');
                    rightArrow.className = 'arrow-key';
                    rightArrow.textContent = '▶';
                    rightArrow.dataset.key = 'right';
                    
                    bottomArrowRow.appendChild(leftArrow);
                    bottomArrowRow.appendChild(downArrow);
                    bottomArrowRow.appendChild(rightArrow);
                    
                    arrowContainer.appendChild(topRow);
                    arrowContainer.appendChild(bottomArrowRow);
                    
                    // Add arrow container to the last row
                    rowElement.appendChild(arrowContainer);
                }
                
                keyboardElement.appendChild(rowElement);
            });
        }

        // Switch between practice and manual mode
        function switchMode(isManual) {
            isManualMode = isManual;
            
            if (isManual) {
                practiceBtn.classList.remove('active-mode');
                manualBtn.classList.add('active-mode');
                manualInputContainer.style.display = 'block';
                wordDisplay.style.display = 'none'; // Hide word display in manual mode
                enableManualInput();
                resetGame();
                messageElement.textContent = 'Type any word and press Enter';
            } else {
                manualBtn.classList.remove('active-mode');
                practiceBtn.classList.add('active-mode');
                manualInputContainer.style.display = 'none';
                wordDisplay.style.display = 'flex'; // Show word display in practice mode
                resetGame();
                messageElement.textContent = 'Press Start to begin practice';
            }
        }

        // Enable manual input
        function enableManualInput() {
            isManualInputEnabled = true;
            manualInput.disabled = false;
            manualInput.placeholder = "Type any word and press Enter";
            manualInput.value = '';
            manualInput.focus();
        }

        // Disable manual input
        function disableManualInput() {
            isManualInputEnabled = false;
            manualInput.disabled = true;
            manualInput.placeholder = "Press Right Arrow to type new word";
        }

        // Start the game
        function startGame() {
            if (isManualMode && !manualInput.value.trim()) {
                messageElement.textContent = 'Please type a word first!';
                return;
            }
            
            gameActive = true;
            currentLetterIndex = 0;
            
            if (isManualMode) {
                currentWord = manualInput.value.toLowerCase().trim();
                // Disable manual input during practice
                disableManualInput();
                wordDisplay.style.display = 'flex'; // Show word display for practice
                wordDisplay.innerHTML = currentWord.split('').map((letter, index) => 
                    index === 0 ? `<span class="current-letter">${letter}</span>` : `<span>${letter}</span>`
                ).join('');
            } else {
                if (currentWordIndex >= wordList.length) {
                    currentWordIndex = 0;
                }
                currentWord = wordList[currentWordIndex];
                updateWordDisplay();
            }
            
            highlightKey(currentWord[0]);
            messageElement.textContent = 'Type the highlighted letter!';
            startButton.textContent = 'Playing...';
        }

        // Load a new word in practice mode
        function loadNextWord() {
            currentWordIndex = (currentWordIndex + 1) % wordList.length;
            currentWord = wordList[currentWordIndex];
            currentLetterIndex = 0;
            updateWordDisplay();
            highlightKey(currentWord[0]);
        }

        // Highlight a key on the keyboard
        function highlightKey(letter) {
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('highlight');
            });
            
            const targetKey = document.querySelector(`.key[data-key="${letter.toLowerCase()}"]`);
            if (targetKey) {
                targetKey.classList.add('highlight');
            }
        }

        // Speech function
        function speakWithCallback(text, callback) {
            if (isSpeaking) {
                setTimeout(() => speakWithCallback(text, callback), 100);
                return;
            }
            
            isSpeaking = true;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            
            const voices = speechSynthesis.getVoices();
            const childVoice = voices.find(voice => 
                voice.name.includes('Child') || 
                voice.name.includes('Kids') ||
                voice.name.includes('Google UK English Female')
            );
            
            if (childVoice) {
                utterance.voice = childVoice;
            }
            
            utterance.onend = function() {
                isSpeaking = false;
                if (callback) callback();
            };
            
            utterance.onerror = function() {
                isSpeaking = false;
                if (callback) callback();
            };
            
            speechSynthesis.speak(utterance);
        }

        // Fast speech function
        function speakFast(text) {
            speechSynthesis.cancel();
            isSpeaking = false;
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            
            const voices = speechSynthesis.getVoices();
            const childVoice = voices.find(voice => 
                voice.name.includes('Child') || 
                voice.name.includes('Kids') ||
                voice.name.includes('Google UK English Female')
            );
            
            if (childVoice) {
                utterance.voice = childVoice;
            }
            
            utterance.onend = function() {
                isSpeaking = false;
            };
            
            utterance.onerror = function() {
                isSpeaking = false;
            };
            
            speechSynthesis.speak(utterance);
        }

        // Speak a key name
        function speakKey(key) {
            let keyName = key;
            
            const keyNames = {
                'esc': 'Escape',
                'f1': 'F1',
                'f2': 'F2',
                'f3': 'F3',
                'f4': 'F4',
                'f5': 'F5',
                'f6': 'F6',
                'f7': 'F7',
                'f8': 'F8',
                'f9': 'F9',
                'f10': 'F10',
                'f11': 'F11',
                'f12': 'F12',
                'del': 'Delete',
                'backspace': 'Backspace',
                'tab': 'Tab',
                'caps': 'Caps Lock',
                'shift': 'Shift',
                'ctrl': 'Control',
                'fn': 'Function',
                'win': 'Windows',
                'alt': 'Alt',
                'space': 'Space',
                'enter': 'Enter',
                'left': 'Left Arrow',
                'right': 'Right Arrow',
                'up': 'Up Arrow',
                'down': 'Down Arrow',
                '`': 'Backtick',
                '-': 'Hyphen',
                '=': 'Equals',
                '[': 'Left Bracket',
                ']': 'Right Bracket',
                '\\': 'Backslash',
                ';': 'Semicolon',
                "'": 'Apostrophe',
                ',': 'Comma',
                '.': 'Period',
                '/': 'Slash'
            };
            
            if (keyNames[key]) {
                keyName = keyNames[key];
            }
            
            speakFast(keyName);
        }

        // Handle manual input typing with voice feedback
        function handleManualInput(event) {
            if (!isManualInputEnabled) {
                event.preventDefault();
                return;
            }
            
            const key = event.key.toLowerCase();
            
            // Don't speak for control keys during manual input
            if (key === 'enter') {
                // Speak the full word when Enter is pressed
                const word = manualInput.value;
                if (word.trim()) {
                    speakFast(word);
                    // Start practice with this word
                    startGame();
                }
                event.preventDefault();
                return;
            }
            
            if (key === 'backspace' || key === 'delete') {
                speakKey('backspace');
                return;
            }
            
            if (key === 'tab') {
                speakKey('tab');
                event.preventDefault();
                return;
            }
            
            // Speak regular characters as they are typed
            if (/^[a-z0-9]$/.test(key)) {
                speakFast(key);
            } else if (key === ' ') {
                speakKey('space');
            }
        }

        // Handle key press from physical keyboard during practice
        function handlePracticeKeyPress(key) {
            if (!gameActive) return;
            
            // Handle right arrow to enable manual input
            if (key === 'right' && isManualMode) {
                enableManualInput();
                wordDisplay.style.display = 'none'; // Hide word display
                resetGame();
                messageElement.textContent = 'Type any word and press Enter';
                return;
            }
            
            // Speak the key name
            speakKey(key);
            
            // Handle special keys
            if (key === 'backspace') {
                if (currentLetterIndex > 0) {
                    currentLetterIndex--;
                    updateWordDisplay();
                    highlightKey(currentWord[currentLetterIndex]);
                }
                return;
            }
            
            if (key === 'enter') {
                // Speak full word when Enter is pressed
                speakFast(currentWord);
                messageElement.textContent = 'Word completed! Press Right Arrow for new word';
                return;
            }
            
            if (key === 'space') {
                key = ' ';
            }
            
            // Ignore function keys
            if (['tab', 'caps', 'shift', 'ctrl', 'alt', 'fn', 'win', 'menu', 'left', 'up', 'down'].includes(key)) {
                return;
            }
            
            const expectedKey = currentWord[currentLetterIndex];
            
            if (key === expectedKey) {
                // Correct key pressed
                currentLetterIndex++;
                updateWordDisplay();
                
                // Check if word is completed
                if (currentLetterIndex >= currentWord.length) {
                    messageElement.textContent = 'Word completed! Press Enter to hear it.';
                } else {
                    highlightKey(currentWord[currentLetterIndex]);
                }
            } else {
                // Wrong key pressed
                speakFast("Try again");
                messageElement.textContent = 'Wrong key! Try again.';
            }
        }

        // Update word display
        function updateWordDisplay() {
            let displayHTML = '';
            for (let i = 0; i < currentWord.length; i++) {
                if (i === currentLetterIndex) {
                    displayHTML += `<span class="current-letter">${currentWord[i]}</span>`;
                } else if (i < currentLetterIndex) {
                    displayHTML += `<span class="completed-word">${currentWord[i]}</span>`;
                } else {
                    displayHTML += `<span>${currentWord[i]}</span>`;
                }
            }
            wordDisplay.innerHTML = displayHTML;
        }

        // Speak the current word
        function speakWord() {
            if (!currentWord) return;
            speakFast(currentWord);
        }

        // Reset the game
        function resetGame() {
            gameActive = false;
            currentLetterIndex = 0;
            currentWordIndex = 0;
            
            if (isManualMode) {
                if (isManualInputEnabled) {
                    wordDisplay.style.display = 'none';
                    messageElement.textContent = 'Type any word and press Enter';
                } else {
                    wordDisplay.style.display = 'flex';
                    wordDisplay.innerHTML = 'Press Start to begin!';
                    messageElement.textContent = 'Press Right Arrow to type new word';
                }
            } else {
                wordDisplay.innerHTML = 'Press Start to begin!';
                messageElement.textContent = 'Press Start to begin practice';
            }
            
            startButton.textContent = 'Start';
            
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('highlight');
            });
        }

        // Event listeners
        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);
        speakButton.addEventListener('click', speakWord);
        
        practiceBtn.addEventListener('click', () => switchMode(false));
        manualBtn.addEventListener('click', () => switchMode(true));
        
        // Manual input event listeners for voice feedback
        manualInput.addEventListener('keydown', handleManualInput);

        // Physical keyboard support for practice mode
        document.addEventListener('keydown', (event) => {
            if (!gameActive && !isManualInputEnabled) return;
            
            const key = event.key.toLowerCase();
            
            if (key === 'backspace') {
                if (isManualInputEnabled) {
                    // Allow backspace in manual input
                    return;
                }
                handlePracticeKeyPress('backspace');
                event.preventDefault();
                return;
            }
            
            if (key === 'enter') {
                if (isManualInputEnabled) {
                    // Allow enter in manual input
                    return;
                }
                handlePracticeKeyPress('enter');
                event.preventDefault();
                return;
            }
            
            if (key === 'arrowright') {
                handlePracticeKeyPress('right');
                event.preventDefault();
                return;
            }
            
            // Check if the key is a letter, number, or symbol
            if (/^[a-z0-9]$/.test(key) || key === ' ' || 
                key === ',' || key === '.' || key === '/' || key === ';' || 
                key === "'" || key === '[' || key === ']' || key === '\\' ||
                key === '`' || key === '-' || key === '=') {
                if (isManualInputEnabled) {
                    // Allow typing in manual input
                    return;
                }
                handlePracticeKeyPress(key);
            }
        });

        // Initialize the game
        initializeKeyboard();
        resetGame();
        
        // Load voices for text-to-speech
        speechSynthesis.onvoiceschanged = () => {
            // Voices are now loaded
        };
    </script>
</body>
</html>
